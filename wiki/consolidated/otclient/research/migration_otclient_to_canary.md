---
tags: [migration, otclient, canary, guide, integration, development]
type: documentation
status: active
priority: high
created: 2025-01-27
updated: 2025-01-27
aliases: [otclient_to_canary_migration, migration_guide, otclient_migration]
---

# üîÑ Guia de Migra√ß√£o: OTClient ‚Üí Canary

## üìã Vis√£o Geral

Este guia fornece instru√ß√µes detalhadas para migrar projetos e m√≥dulos do **OTClient** para o **Canary**, garantindo compatibilidade e funcionalidade completa no novo ambiente.

### üéØ Objetivo

Migrar c√≥digo OTClient para Canary de forma segura e eficiente, mantendo:
- ‚úÖ Funcionalidade completa
- ‚úÖ Performance otimizada
- ‚úÖ Compatibilidade de protocolos
- ‚úÖ Interface de usu√°rio consistente

---

## üîç **1. Prepara√ß√£o para Migra√ß√£o**

### üìä An√°lise de Compatibilidade

#### **Verifica√ß√£o Autom√°tica**
```bash
# Executar an√°lise de compatibilidade
python check_compatibility.py --source otclient --target canary --module meu_modulo

# Gerar relat√≥rio detalhado
python generate_migration_report.py --source otclient --target canary --output relatorio_migracao.json
```

#### **Checklist de Prepara√ß√£o**
- [ ] **An√°lise de depend√™ncias** - Verificar m√≥dulos e bibliotecas
- [ ] **Verifica√ß√£o de APIs** - Identificar APIs espec√≠ficas OTClient
- [ ] **An√°lise de protocolos** - Validar compatibilidade de rede
- [ ] **Verifica√ß√£o de recursos** - Confirmar disponibilidade no Canary
- [ ] **Backup do c√≥digo** - Criar backup completo antes da migra√ß√£o

### üõ†Ô∏è Ferramentas de Migra√ß√£o

#### **Scripts de An√°lise**
```python
# An√°lise de compatibilidade
def analyze_compatibility(module_path: str) -> Dict[str, Any]:
    """Analisa compatibilidade de um m√≥dulo OTClient com Canary"""
    
    analysis = {
        "compatibility_score": 0.0,
        "issues_found": [],
        "suggestions": [],
        "migration_steps": []
    }
    
    # Verificar APIs espec√≠ficas OTClient
    otclient_apis = detect_otclient_apis(module_path)
    for api in otclient_apis:
        if not is_canary_compatible(api):
            analysis["issues_found"].append(f"API n√£o compat√≠vel: {api}")
            analysis["suggestions"].append(f"Substituir {api} por equivalente Canary")
    
    # Calcular score de compatibilidade
    analysis["compatibility_score"] = calculate_compatibility_score(analysis)
    
    return analysis
```

---

## üîß **2. Adapta√ß√£o de C√≥digo**

### üì¶ M√≥dulos Core

#### **Sistema de UI**
#### N√≠vel Basic
```lua
-- C√≥digo original OTClient
local function createOTClientUI()
    local button = g_ui.createWidget('Button', parent)
    button:setText("Clique aqui")
    button.onClick = function()
        print("Bot√£o clicado!")
    end
end

-- C√≥digo adaptado para Canary
local function createCanaryUI()
    if Canary then
        -- Implementa√ß√£o Canary
        local button = UI.createButton({
            text = "Clique aqui",
            onClick = function()
                print("Bot√£o clicado!")
            end
        })
    else
        -- Fallback OTClient
        local button = g_ui.createWidget('Button', parent)
        button:setText("Clique aqui")
        button.onClick = function()
            print("Bot√£o clicado!")
        end
    end
end
```

#### N√≠vel Intermediate
```lua
-- C√≥digo original OTClient
local function createOTClientUI()
    local button = g_ui.createWidget('Button', parent)
    button:setText("Clique aqui")
    button.onClick = function()
        print("Bot√£o clicado!")
    end
end

-- C√≥digo adaptado para Canary
local function createCanaryUI()
    if Canary then
        -- Implementa√ß√£o Canary
        local button = UI.createButton({
            text = "Clique aqui",
            onClick = function()
                print("Bot√£o clicado!")
            end
        })
    else
        -- Fallback OTClient
        local button = g_ui.createWidget('Button', parent)
        button:setText("Clique aqui")
        button.onClick = function()
            print("Bot√£o clicado!")
        end
    end
end
-- Adicionar tratamento de erros
local success, result = pcall(function()
    -- C√≥digo original aqui
end)
if not success then
    print('Erro:', result)
end
```

#### N√≠vel Advanced
```lua
-- C√≥digo original OTClient
local function createOTClientUI()
    local button = g_ui.createWidget('Button', parent)
    button:setText("Clique aqui")
    button.onClick = function()
        print("Bot√£o clicado!")
    end
end

-- C√≥digo adaptado para Canary
local function createCanaryUI()
    if Canary then
        -- Implementa√ß√£o Canary
        local button = UI.createButton({
            text = "Clique aqui",
            onClick = function()
                print("Bot√£o clicado!")
            end
        })
    else
        -- Fallback OTClient
        local button = g_ui.createWidget('Button', parent)
        button:setText("Clique aqui")
        button.onClick = function()
            print("Bot√£o clicado!")
        end
    end
end
-- Adicionar metatable para funcionalidade avan√ßada
local mt = {
    __index = function(t, k)
        return rawget(t, k) or 'Valor n√£o encontrado'
    end
    __call = function(t, ...)
        print('Objeto chamado com:', ...)
    end
}
setmetatable(meuObjeto, mt)
```

#### **Sistema de Rede**
#### N√≠vel Basic
```lua
-- C√≥digo original OTClient
local function connectOTClient()
    g_game.connect(server, port)
    g_game.login(username, password)
end

-- C√≥digo adaptado para Canary
local function connectCanary()
    if Canary then
        -- Implementa√ß√£o Canary
        Network.connect({
            host = server,
            port = port,
            onConnect = function()
                Network.login(username, password)
            end
        })
    else
        -- Fallback OTClient
        g_game.connect(server, port)
        g_game.login(username, password)
    end
end
```

#### N√≠vel Intermediate
```lua
-- C√≥digo original OTClient
local function connectOTClient()
    g_game.connect(server, port)
    g_game.login(username, password)
end

-- C√≥digo adaptado para Canary
local function connectCanary()
    if Canary then
        -- Implementa√ß√£o Canary
        Network.connect({
            host = server,
            port = port,
            onConnect = function()
                Network.login(username, password)
            end
        })
    else
        -- Fallback OTClient
        g_game.connect(server, port)
        g_game.login(username, password)
    end
end
-- Adicionar tratamento de erros
local success, result = pcall(function()
    -- C√≥digo original aqui
end)
if not success then
    print('Erro:', result)
end
```

#### N√≠vel Advanced
```lua
-- C√≥digo original OTClient
local function connectOTClient()
    g_game.connect(server, port)
    g_game.login(username, password)
end

-- C√≥digo adaptado para Canary
local function connectCanary()
    if Canary then
        -- Implementa√ß√£o Canary
        Network.connect({
            host = server,
            port = port,
            onConnect = function()
                Network.login(username, password)
            end
        })
    else
        -- Fallback OTClient
        g_game.connect(server, port)
        g_game.login(username, password)
    end
end
-- Adicionar metatable para funcionalidade avan√ßada
local mt = {
    __index = function(t, k)
        return rawget(t, k) or 'Valor n√£o encontrado'
    end
    __call = function(t, ...)
        print('Objeto chamado com:', ...)
    end
}
setmetatable(meuObjeto, mt)
```

### üéÆ Sistemas de Jogo

#### **Sistema de Criaturas**
#### N√≠vel Basic
```lua
-- C√≥digo original OTClient
local function createCreatureOTClient()
    local creature = g_map.getCreatureById(creatureId)
    if creature then
        creature:setOutfit(outfit)
        creature:setDirection(direction)
    end
end

-- C√≥digo adaptado para Canary
local function createCreatureCanary()
    if Canary then
        -- Implementa√ß√£o Canary
        local creature = Game.Creature.getById(creatureId)
        if creature then
            creature:setOutfit(outfit)
            creature:setDirection(direction)
        end
    else
        -- Fallback OTClient
        local creature = g_map.getCreatureById(creatureId)
        if creature then
            creature:setOutfit(outfit)
            creature:setDirection(direction)
        end
    end
end
```

#### N√≠vel Intermediate
```lua
-- C√≥digo original OTClient
local function createCreatureOTClient()
    local creature = g_map.getCreatureById(creatureId)
    if creature then
        creature:setOutfit(outfit)
        creature:setDirection(direction)
    end
end

-- C√≥digo adaptado para Canary
local function createCreatureCanary()
    if Canary then
        -- Implementa√ß√£o Canary
        local creature = Game.Creature.getById(creatureId)
        if creature then
            creature:setOutfit(outfit)
            creature:setDirection(direction)
        end
    else
        -- Fallback OTClient
        local creature = g_map.getCreatureById(creatureId)
        if creature then
            creature:setOutfit(outfit)
            creature:setDirection(direction)
        end
    end
end
-- Adicionar tratamento de erros
local success, result = pcall(function()
    -- C√≥digo original aqui
end)
if not success then
    print('Erro:', result)
end
```

#### N√≠vel Advanced
```lua
-- C√≥digo original OTClient
local function createCreatureOTClient()
    local creature = g_map.getCreatureById(creatureId)
    if creature then
        creature:setOutfit(outfit)
        creature:setDirection(direction)
    end
end

-- C√≥digo adaptado para Canary
local function createCreatureCanary()
    if Canary then
        -- Implementa√ß√£o Canary
        local creature = Game.Creature.getById(creatureId)
        if creature then
            creature:setOutfit(outfit)
            creature:setDirection(direction)
        end
    else
        -- Fallback OTClient
        local creature = g_map.getCreatureById(creatureId)
        if creature then
            creature:setOutfit(outfit)
            creature:setDirection(direction)
        end
    end
end
-- Adicionar metatable para funcionalidade avan√ßada
local mt = {
    __index = function(t, k)
        return rawget(t, k) or 'Valor n√£o encontrado'
    end
    __call = function(t, ...)
        print('Objeto chamado com:', ...)
    end
}
setmetatable(meuObjeto, mt)
```

---

## üß™ **3. Testes de Migra√ß√£o**

### üìä Testes de Compatibilidade

#### **Suite de Testes Automatizados**
```python
# Teste de compatibilidade
def test_migration_compatibility():
    """Executa testes de compatibilidade ap√≥s migra√ß√£o"""
    
    test_cases = [
        "ui_components",
        "network_protocols", 
        "game_systems",
        "file_formats",
        "performance_metrics"
    ]
    
    results = {}
    
    for test_case in test_cases:
        print(f"üß™ Executando teste: {test_case}")
        result = run_compatibility_test(test_case)
        results[test_case] = result
        
        if result["success"]:
            print(f"‚úÖ {test_case}: PASS")
        else:
            print(f"‚ùå {test_case}: FAIL - {result['error']}")
    
    return generate_test_report(results)
```

#### **Testes de Performance**
```lua
-- Teste de performance
    --  Teste de performance (traduzido)
local function testPerformance()
    local startTime = os.clock()
    
    -- Executar opera√ß√£o migrada
    performMigratedOperation()
    
    local endTime = os.clock()
    local duration = endTime - startTime
    
    -- Validar performance
    --  Validar performance (traduzido)
    if duration > MAX_ACCEPTABLE_TIME then
    -- Verifica√ß√£o condicional
        print("‚ö†Ô∏è Performance abaixo do esperado: " .. duration .. "s")
        return false
    else
        print("‚úÖ Performance aceit√°vel: " .. duration .. "s")
        return true
    end
end
```

### üîç Valida√ß√£o de Funcionalidade

#### **Checklist de Valida√ß√£o**
- [ ] **Interface de usu√°rio** - Todos os elementos visuais funcionando
- [ ] **Comunica√ß√£o de rede** - Conex√£o e protocolos funcionando
- [ ] **Sistemas de jogo** - Criaturas, itens, magias funcionando
- [ ] **Performance** - Tempo de resposta aceit√°vel
- [ ] **Estabilidade** - Sem crashes ou erros cr√≠ticos
- [ ] **Compatibilidade** - Funciona com vers√µes antigas

---

## üöÄ **4. Deploy e Valida√ß√£o**

### üì¶ Processo de Deploy

#### **Script de Deploy Automatizado**
```bash
#!/bin/bash
# deploy_migration.sh

echo "üöÄ Iniciando deploy da migra√ß√£o..."

# 1. Backup do sistema atual
echo "üì¶ Criando backup..."
python create_backup.py --target canary

# 2. Deploy do c√≥digo migrado
echo "üîß Deployando c√≥digo migrado..."
python deploy_migrated_code.py --source otclient --target canary

# 3. Valida√ß√£o p√≥s-deploy
echo "üß™ Validando deploy..."
python validate_deployment.py --target canary

# 4. Testes de integra√ß√£o
echo "üîç Executando testes de integra√ß√£o..."
python run_integration_tests.py --target canary

echo "‚úÖ Deploy conclu√≠do!"
```

### üìä Monitoramento P√≥s-Deploy

#### **M√©tricas de Monitoramento**
```lua
-- Sistema de monitoramento
    --  Sistema de monitoramento (traduzido)
local MigrationMonitor = require('monitor.migration')

-- Configurar monitoramento
    --  Configurar monitoramento (traduzido)
MigrationMonitor.configure({
    check_interval = 5000, -- 5 segundos
    alert_threshold = 0.9, -- 90%
    metrics = {
        "performance",
        "stability", 
        "compatibility",
        "user_satisfaction"
    }
})

-- Iniciar monitoramento
    --  Iniciar monitoramento (traduzido)
MigrationMonitor.start()
```

---

## üîß **5. Resolu√ß√£o de Problemas**

### üö® Problemas Comuns

#### **Problema: APIs Incompat√≠veis**
```lua
-- Solu√ß√£o: Implementar wrapper de compatibilidade
local CompatibilityWrapper = {}

function CompatibilityWrapper.createUIElement(elementType, config)
    -- Fun√ß√£o: CompatibilityWrapper
    if Canary then
    -- Verifica√ß√£o condicional
        return CanaryUI.create(elementType, config)
    else
        return g_ui.createWidget(elementType, config.parent)
    end
end
```

#### **Problema: Diferen√ßas de Protocolo**
```lua
-- Solu√ß√£o: Adaptador de protocolo
local ProtocolAdapter = {}

function ProtocolAdapter.sendMessage(message)
    -- Fun√ß√£o: ProtocolAdapter
    if Canary then
    -- Verifica√ß√£o condicional
        return CanaryProtocol.send(message)
    else
        return g_game.sendMessage(message)
    end
end
```

### üìã Troubleshooting Guide

| Problema | Sintoma | Solu√ß√£o |
|----------|---------|---------|
| **UI n√£o renderiza** | Elementos invis√≠veis | Verificar APIs de UI |
| **Conex√£o falha** | Timeout de rede | Validar protocolos |
| **Performance lenta** | Lag ou travamentos | Otimizar c√≥digo |
| **Crashes** | Erros cr√≠ticos | Verificar compatibilidade |

---

## üìö **6. Recursos Adicionais**

### üîó **Links Autom√°ticos**

> [!info] **Links Gerados Automaticamente**
> Estes links foram criados automaticamente pelo sistema de linkagem da categoria **Documentation**

### **üìö Links Obrigat√≥rios**
- [[../README|Hub Central da Wiki]]
- [[../dashboard/task_master|Task Master]]
- [[../dashboard/integrated_task_manager|Dashboard Central]]
- [[../maps/search_index|√çndice de Busca]]
- [[../maps/tags_index|√çndice de Tags]]

### **üß≠ Navega√ß√£o**
- [[../maps/search_index|√çndice de Busca]]
- [[../maps/tags_index|√çndice de Tags]]
- [[../maps/category_indices|√çndices por Categoria]]
- [[../maps/relationships|Relacionamentos]]

### **üìä M√©tricas da Categoria**
- **Categoria**: Documentation
- **Total de arquivos**: <!-- Contador autom√°tico -->
- **Arquivos linkados**: <!-- Contador autom√°tico -->
- **Taxa de linkagem**: <!-- Percentual autom√°tico -->

---

## üîó Links √öteis
- **Documenta√ß√£o Canary**: [wiki/canary/](wiki/canary/)
- **APIs Unificadas**: [wiki/docs/otclient_canary_unified_documentation.md](wiki/docs/otclient_canary_unified_documentation.md)
- **Testes de Integra√ß√£o**: [wiki/integration/](wiki/integration/)

### üõ†Ô∏è Ferramentas
- **Integration Agent**: [wiki/bmad/agents/integration_agent.py](wiki/bmad/agents/integration_agent.py)
- **Migration Workflow**: [wiki/bmad/workflows/migration_workflow.py](wiki/bmad/workflows/migration_workflow.py)

---

## üìù **Hist√≥rico de Vers√µes**

### v1.0.0 (2025-01-27)
- ‚úÖ Guia de migra√ß√£o OTClient ‚Üí Canary
- ‚úÖ Scripts de an√°lise de compatibilidade
- ‚úÖ Templates de c√≥digo adaptado
- ‚úÖ Testes de valida√ß√£o
- ‚úÖ Troubleshooting guide

---

*Guia criado pelo Sistema BMAD - Integra√ß√£o Total OTClient-Canary* 